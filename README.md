# 基础模板项目

## 实体模型

![avatar][database_model]
[database_model]:./imgs/database.png


## 字典模块

### 模块说明

现阶段的设计是为了权限模块的配置，没有兼容业务需求。字典分了两个业务概念：

* 字典的索引
* 字典索引的明细

### 使用

出完接口后(不一定要实现)，需要手动对接口进行分组，每一组建立一个索引，每一组的接口就是索引的明细。新建菜单时，就根据索引查询明细，获取该菜单所有的操作。

### 目的

* 分离菜单的定义和创建。由相关人员对特定的菜单功能进行定义设计，由用户决定实际需要哪些功能。
* 适配数据权限的设计。对数据做权限控制的前提是对操作进行拦截，需要精确推断出用户所执行的操作是否有权限。因此，权限的设计需要精确到操作，而不仅仅是菜单。

### 实体设计

业务上区分了两种概念：索引和索引的明细。在数据层面上，只有一种概念：索引。
索引是一种树状结构的数据，有父子的继承性质。
实体数据表：

![avatar][t_dictionary_entity]

[t_dictionary_entity]: ./imgs/t_dictonary.png

## 数据权限控制模块

### 模块说明

数据的权限关联到角色上，每个角色有一定的数据访问范围：本人，本组织，指定用户。

### 实体设计

实体数据表：

![avatar][t_role_databind_entity]

[t_role_databind_entity]:./imgs/t_role_databind.png

### 核心逻辑

* 第一阶段-创建角色

> 在创建角色时，需要定义好角色的数据访问范围。默认是本人的范围，并且必须有本人的范围。选择其余两种范围也会默认创建本人的范围。

* 第二阶段-拦截控制

> 在创建角色的时候，会绑定一些权限，其中包括菜单浏览权限和功能操作权限。在用户发起操作请求时，对请求进行拦截。结合用户的角色集合，推断操作权限所属的角色。
> 得到角色后，就可以查询到该角色的数据访问范围，并传递给业务操作。

## 用户管理模块

### 模块说明

* 管理用户的信息，提供手动添加或者批量导出导入的操作。
* 维护用户的数据访问控制信息。在添加用户的时候，会根据角色的数据访问信息和部门信息产生用户的数据访问控制信息。

### 核心逻辑

* 第一阶段-创建用户

* 第二阶段-关联用户和组织

* 第三阶段-关联用户和角色

* 第四阶段-产生数据访问控制信息

> 遍历用户的角色列表，对每个角色逐一处理。
>判断角色的数据访问范围类型，不同的类型采取不同处理策略。
>> 本人类型的:使用用户的id作为数据源id，添加一条本人类型的数据绑定记录。
>> 本组织类型的:遍历用户的组织，每一个组织都使用组织id作为数据源id添加本组织类型的数据绑定记录。
>> 指定人员类型的:和组织类似，不同的是遍历指定的人员而不是组织。


